// Generated by CoffeeScript 1.10.0
(function() {
  var js2php, jsExpressionToPhp;

  js2php = require('js2php');

  jsExpressionToPhp = function(jsExpr, opts) {
    var phpCode, phpExpression, replaced, token_re;
    if (opts == null) {
      opts = {};
    }
    if (typeof opts.arraysOnly === 'undefined') {
      opts.arraysOnly = true;
    }
    if (/^\{.*\}$/.test(jsExpr)) {
      jsExpr = "(" + jsExpr + ")";
    }
    jsExpr = jsExpr.replace(/^\s*\(([a-zA-Z_][a-z_A-Z0-9]*(\.[a-zA-Z_][a-z_A-Z0-9]*)*)\)/g, '$1');
    jsExpr = jsExpr.replace(/\+\s*\(([a-zA-Z_][a-z_A-Z0-9]*(\.[a-zA-Z_][a-z_A-Z0-9]*)*)\)/g, '+ $1');
    token_re = /(([a-zA-Z_][a-z_A-Z0-9]*(\.[a-zA-Z_][a-z_A-Z0-9]*)*)|("[^"]*")|('[^']*')|(\d+))|(\s*\+\s*)/g;
    jsExpr = jsExpr.replace(token_re, function(s) {
      return '■' + s;
    });
    replaced = true;
    while (replaced) {
      replaced = false;
      jsExpr = jsExpr.replace(/(■([a-zA-Z_][a-z_A-Z0-9]*(\.[a-zA-Z_][a-z_A-Z0-9]*)*)|■("[^"]*")|■('[^']*')|■(\d+))(■\s*\+\s*(■([a-zA-Z_][a-z_A-Z0-9]*(\.[a-zA-Z_][a-z_A-Z0-9]*)*)|■("[^"]*")|■('[^']*')|■(\d+)))+/g, function(s) {
        replaced = true;
        return "add(" + (s.replace(/■\s*\+\s*/g, ', ')) + ")";
      });
    }
    jsExpr = jsExpr.replace(/■/g, '');
    phpCode = js2php(jsExpr);
    phpExpression = phpCode.replace(/^<\?php\n/g, "").replace(/;\n$/g, "").replace(/;\n/g, "; ");
    if (opts.arraysOnly && /^(!)?\s*\$?[a-zA-Z_][a-z_A-Z0-9]*/.test(phpExpression)) {
      phpExpression = phpExpression.replace(/->([a-zA-Z_][a-z_A-Z0-9]*)/g, "['\$1']");
    }
    return phpExpression;
  };

  module.exports = jsExpressionToPhp;

}).call(this);
