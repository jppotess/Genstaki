// Generated by CoffeeScript 1.9.1
(function() {
	var _, gutil, jade2php, objectAssign, phpDefaultOptions, through;

	gutil = require("gulp-util");

	through = require("through2");

	objectAssign = require("object-assign");

	jade2php = require("jade2php");

	_ = require('lodash');

	phpDefaultOptions = {
		omitPhpExtractor: false,
		omitPhpRuntime: false,
		arraysOnly: true
	};

	module.exports = function(options) {
		options = options || {};
		return through.obj(function(file, enc, cb) {
			var err;
			if (file.isNull()) {
				cb(null, file);
				return;
			}
			if (file.isStream()) {
				cb(new gutil.PluginError("gulp-jade2php", "Streaming not supported"));
				return;
			}
			options = objectAssign({}, options, {
				source: file.path
			});
			try {
				file.contents = new Buffer(jade2php(file.contents.toString(), _.merge(phpDefaultOptions, options)));
				this.push(file);
			}
			catch (_error) {
				err = _error;
				this.emit("error", new gutil.PluginError("gulp-jade2php", err, {
					fileName: file.path
				}));
			}
			return cb();
		});
	};

}).call(this);
